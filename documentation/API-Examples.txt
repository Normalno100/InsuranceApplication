# üìò API Examples - Travel Insurance V2

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### Base URL
```
Production:  https://api.travel-insurance.com/insurance/travel/v2
Staging:     https://staging.travel-insurance.com/insurance/travel/v2
Local:       http://localhost:8080/insurance/travel/v2
```

---

## üìã –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–ø—É—Å–∫ –≤ –ò—Å–ø–∞–Ω–∏–∏ üá™üá∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –ö–ª–∏–µ–Ω—Ç: –î–∂–æ–Ω –°–º–∏—Ç, 35 –ª–µ—Ç
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ò—Å–ø–∞–Ω–∏—è
- –ü–µ—Ä–∏–æ–¥: 14 –¥–Ω–µ–π (01.06 - 14.06.2025)
- –ü–æ–∫—Ä—ã—Ç–∏–µ: 30,000 EUR
- –ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤

**HTTP Request:**
```http
POST /insurance/travel/v2/calculate HTTP/1.1
Host: api.travel-insurance.com
Content-Type: application/json

{
  "personFirstName": "John",
  "personLastName": "Smith",
  "personBirthDate": "1988-05-15",
  "agreementDateFrom": "2025-06-01",
  "agreementDateTo": "2025-06-14",
  "countryIsoCode": "ES",
  "medicalRiskLimitLevel": "LEVEL_50000",
  "currency": "EUR"
}
```

**HTTP Response:**
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "personFirstName": "John",
  "personLastName": "Smith",
  "personBirthDate": "1988-05-15",
  "personAge": 36,
  "agreementDateFrom": "2025-06-01",
  "agreementDateTo": "2025-06-14",
  "agreementDays": 14,
  "countryIsoCode": "ES",
  "countryName": "Spain",
  "medicalRiskLimitLevel": "LEVEL_50000",
  "coverageAmount": 50000.00,
  "selectedRisks": [],
  "riskPremiums": [
    {
      "riskType": "TRAVEL_MEDICAL",
      "riskName": "Medical Coverage",
      "premium": 69.30,
      "coefficient": 0.00
    }
  ],
  "agreementPriceBeforeDiscount": 69.30,
  "discountAmount": 0.00,
  "agreementPrice": 69.30,
  "currency": "EUR",
  "calculation": {
    "baseRate": 4.50,
    "ageCoefficient": 1.10,
    "countryCoefficient": 1.00,
    "additionalRisksCoefficient": 0.00,
    "totalCoefficient": 1.10,
    "days": 14,
    "formula": "Premium = 4.50 √ó 1.10 √ó 1.00 √ó 14 days",
    "steps": [
      {
        "description": "Base rate per day",
        "formula": "Base Rate",
        "result": 4.50
      },
      {
        "description": "Age coefficient",
        "formula": "Base Rate √ó Age Coeff = 4.50 √ó 1.10",
        "result": 4.95
      },
      {
        "description": "Country risk coefficient",
        "formula": "Previous √ó Country Coeff = 4.95 √ó 1.00",
        "result": 4.95
      },
      {
        "description": "Multiply by number of days",
        "formula": "Previous √ó 14 days",
        "result": 69.30
      }
    ]
  },
  "errors": null
}
```

**cURL:**
```bash
curl -X POST https://api.travel-insurance.com/insurance/travel/v2/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "personFirstName": "John",
    "personLastName": "Smith",
    "personBirthDate": "1988-05-15",
    "agreementDateFrom": "2025-06-01",
    "agreementDateTo": "2025-06-14",
    "countryIsoCode": "ES",
    "medicalRiskLimitLevel": "LEVEL_50000",
    "currency": "EUR"
  }'
```

---

### –ü—Ä–∏–º–µ—Ä 2: –ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π —Ç—É—Ä –≤ –ê–≤—Å—Ç—Ä–∏–∏ ‚õ∑Ô∏è

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –ö–ª–∏–µ–Ω—Ç: –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞, 28 –ª–µ—Ç
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ê–≤—Å—Ç—Ä–∏—è
- –ü–µ—Ä–∏–æ–¥: 7 –¥–Ω–µ–π (15.01 - 21.01.2025)
- –ü–æ–∫—Ä—ã—Ç–∏–µ: 50,000 EUR
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏: –ê–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Ä—Ç
- –ü—Ä–æ–º–æ-–∫–æ–¥: WINTER2025

**HTTP Request:**
```http
POST /insurance/travel/v2/calculate HTTP/1.1
Content-Type: application/json

{
  "personFirstName": "Maria",
  "personLastName": "Ivanova",
  "personBirthDate": "1996-03-20",
  "agreementDateFrom": "2025-01-15",
  "agreementDateTo": "2025-01-21",
  "countryIsoCode": "AT",
  "medicalRiskLimitLevel": "LEVEL_50000",
  "selectedRisks": ["SPORT_ACTIVITIES"],
  "currency": "EUR",
  "promoCode": "WINTER2025"
}
```

**HTTP Response:**
```json
{
  "personFirstName": "Maria",
  "personLastName": "Ivanova",
  "personAge": 28,
  "agreementDays": 7,
  "countryName": "Austria",
  "coverageAmount": 50000.00,
  "selectedRisks": ["SPORT_ACTIVITIES"],
  "riskPremiums": [
    {
      "riskType": "TRAVEL_MEDICAL",
      "riskName": "Medical Coverage",
      "premium": 31.50,
      "coefficient": 0.00
    },
    {
      "riskType": "SPORT_ACTIVITIES",
      "riskName": "Sport Activities",
      "premium": 9.45,
      "coefficient": 0.30
    }
  ],
  "agreementPriceBeforeDiscount": 40.95,
  "discountAmount": 6.14,
  "agreementPrice": 34.81,
  "currency": "EUR",
  "calculation": {
    "baseRate": 4.50,
    "ageCoefficient": 1.00,
    "countryCoefficient": 1.00,
    "additionalRisksCoefficient": 0.30,
    "totalCoefficient": 1.30,
    "days": 7
  },
  "promoCodeInfo": {
    "code": "WINTER2025",
    "description": "Winter discount 15%",
    "discountType": "PERCENTAGE",
    "discountValue": 15.00,
    "actualDiscountAmount": 6.14
  }
}
```

---

### –ü—Ä–∏–º–µ—Ä 3: –≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –¢–∞–∏–ª–∞–Ω–¥ üèùÔ∏è

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –ö–ª–∏–µ–Ω—Ç: –ü–µ—Ç—Ä –°–∏–¥–æ—Ä–æ–≤, 55 –ª–µ—Ç
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¢–∞–∏–ª–∞–Ω–¥
- –ü–µ—Ä–∏–æ–¥: 21 –¥–µ–Ω—å
- –ü–æ–∫—Ä—ã—Ç–∏–µ: 100,000 EUR
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏: –ê–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Ä—Ç + –•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è

**HTTP Request:**
```json
{
  "personFirstName": "Peter",
  "personLastName": "Sidorov",
  "personBirthDate": "1969-08-10",
  "agreementDateFrom": "2025-03-01",
  "agreementDateTo": "2025-03-21",
  "countryIsoCode": "TH",
  "medicalRiskLimitLevel": "LEVEL_100000",
  "selectedRisks": [
    "SPORT_ACTIVITIES",
    "CHRONIC_DISEASES"
  ],
  "currency": "EUR"
}
```

**HTTP Response:**
```json
{
  "personAge": 55,
  "agreementDays": 21,
  "countryName": "Thailand",
  "coverageAmount": 100000.00,
  "selectedRisks": ["SPORT_ACTIVITIES", "CHRONIC_DISEASES"],
  "agreementPriceBeforeDiscount": 519.78,
  "discountAmount": 0.00,
  "agreementPrice": 519.78,
  "calculation": {
    "baseRate": 7.00,
    "ageCoefficient": 1.60,
    "countryCoefficient": 1.30,
    "additionalRisksCoefficient": 0.70,
    "totalCoefficient": 3.536,
    "days": 21,
    "formula": "Premium = 7.00 √ó 1.60 √ó 1.30 √ó (1 + 0.70) √ó 21 days"
  }
}
```

---

### –ü—Ä–∏–º–µ—Ä 4: –ì—Ä—É–ø–ø–æ–≤–∞—è –ø–æ–µ–∑–¥–∫–∞ (—Å–µ–º—å—è) üë®‚Äçüë©‚Äçüëß‚Äçüë¶

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- 5 —á–µ–ª–æ–≤–µ–∫ (—Å–µ–º—å—è)
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –§—Ä–∞–Ω—Ü–∏—è
- –ü–µ—Ä–∏–æ–¥: 10 –¥–Ω–µ–π
- –ü–æ–∫—Ä—ã—Ç–∏–µ: 30,000 EUR
- –ì—Ä—É–ø–ø–æ–≤–∞—è —Å–∫–∏–¥–∫–∞ 10%

**HTTP Request:**
```json
{
  "personFirstName": "John",
  "personLastName": "Family",
  "personBirthDate": "1985-01-01",
  "agreementDateFrom": "2025-07-01",
  "agreementDateTo": "2025-07-10",
  "countryIsoCode": "FR",
  "medicalRiskLimitLevel": "LEVEL_50000",
  "personsCount": 5,
  "currency": "EUR"
}
```

**HTTP Response:**
```json
{
  "agreementPriceBeforeDiscount": 225.00,
  "discountAmount": 22.50,
  "agreementPrice": 202.50,
  "appliedDiscounts": [
    {
      "discountType": "GROUP",
      "name": "Group discount 5+ persons",
      "percentage": 10.00,
      "amount": 22.50
    }
  ]
}
```

---

### –ü—Ä–∏–º–µ—Ä 5: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç üíº

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–®–ê
- –ü–µ—Ä–∏–æ–¥: 14 –¥–Ω–µ–π
- –ü–æ–∫—Ä—ã—Ç–∏–µ: 200,000 EUR
- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–∫–∏–¥–∫–∞ 20%

**HTTP Request:**
```json
{
  "personFirstName": "Corporate",
  "personLastName": "Client",
  "personBirthDate": "1980-01-01",
  "agreementDateFrom": "2025-09-01",
  "agreementDateTo": "2025-09-14",
  "countryIsoCode": "US",
  "medicalRiskLimitLevel": "LEVEL_200000",
  "isCorporate": true,
  "currency": "USD"
}
```

**HTTP Response:**
```json
{
  "agreementPriceBeforeDiscount": 312.48,
  "discountAmount": 62.50,
  "agreementPrice": 249.98,
  "currency": "USD",
  "appliedDiscounts": [
    {
      "discountType": "CORPORATE",
      "name": "Corporate discount",
      "percentage": 20.00,
      "amount": 62.50
    }
  ]
}
```

---

## üîç –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω

**Request:**
```http
GET /insurance/travel/v2/countries HTTP/1.1
```

**Response:**
```json
{
  "countries": [
    {
      "isoCode": "ES",
      "nameEn": "Spain",
      "nameRu": "–ò—Å–ø–∞–Ω–∏—è",
      "riskGroup": "LOW",
      "riskCoefficient": 1.0
    },
    {
      "isoCode": "TH",
      "nameEn": "Thailand",
      "nameRu": "–¢–∞–∏–ª–∞–Ω–¥",
      "riskGroup": "MEDIUM",
      "riskCoefficient": 1.3
    }
  ]
}
```

### –ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ø–æ–∫—Ä—ã—Ç–∏—è

**Request:**
```http
GET /insurance/travel/v2/coverage-levels HTTP/1.1
```

**Response:**
```json
{
  "levels": [
    {
      "code": "LEVEL_50000",
      "coverage": 50000.00,
      "dailyRate": 4.50,
      "currency": "EUR"
    },
    {
      "code": "LEVEL_100000",
      "coverage": 100000.00,
      "dailyRate": 7.00,
      "currency": "EUR"
    }
  ]
}
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø—ã —Ä–∏—Å–∫–æ–≤

**Request:**
```http
GET /insurance/travel/v2/risk-types HTTP/1.1
```

**Response:**
```json
{
  "riskTypes": [
    {
      "code": "SPORT_ACTIVITIES",
      "nameEn": "Sport Activities",
      "nameRu": "–ê–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Ä—Ç",
      "coefficient": 0.30,
      "mandatory": false
    },
    {
      "code": "EXTREME_SPORT",
      "nameEn": "Extreme Sport",
      "coefficient": 0.60,
      "mandatory": false
    }
  ]
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ-–∫–æ–¥–∞

**Request:**
```http
GET /insurance/travel/v2/promo-codes/SUMMER2025 HTTP/1.1
```

**Response:**
```json
{
  "code": "SUMMER2025",
  "message": "Valid promo code. 10% discount",
  "isValid": true,
  "description": "Summer discount 10%",
  "discountType": "PERCENTAGE",
  "discountValue": 10.00,
  "validFrom": "2025-06-01",
  "validTo": "2025-08-31"
}
```

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ü—Ä–∏–º–µ—Ä 1: –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**Request:**
```json
{
  "personFirstName": "",
  "personLastName": "Smith",
  "agreementDateFrom": "2025-06-01",
  "agreementDateTo": "2025-05-01"
}
```

**Response:**
```http
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
  "errors": [
    {
      "field": "personFirstName",
      "message": "Must not be empty!"
    },
    {
      "field": "personBirthDate",
      "message": "Must not be empty!"
    },
    {
      "field": "agreementDateTo",
      "message": "Must be after agreementDateFrom!"
    },
    {
      "field": "countryIsoCode",
      "message": "Must not be empty!"
    },
    {
      "field": "medicalRiskLimitLevel",
      "message": "Must not be empty!"
    }
  ]
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞

**Request:**
```json
{
  "countryIsoCode": "XX"
}
```

**Response:**
```http
HTTP/1.1 400 Bad Request

{
  "errors": [
    {
      "field": "countryIsoCode",
      "message": "Unknown country: XX"
    }
  ]
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ-–∫–æ–¥

**Request:**
```json
{
  "promoCode": "INVALID123"
}
```

**Response:**
```http
HTTP/1.1 200 OK

{
  "agreementPrice": 69.30,
  "discountAmount": 0.00,
  "promoCodeInfo": null,
  "errors": [
    {
      "field": "promoCode",
      "message": "Promo code not found or expired"
    }
  ]
}
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ API v1 vs v2

| –§—É–Ω–∫—Ü–∏—è | API v1 | API v2 |
|---------|--------|--------|
| –†–∞—Å—á–µ—Ç –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É | ‚ùå | ‚úÖ |
| –£—á–µ—Ç —Å—Ç—Ä–∞–Ω—ã | ‚ùå | ‚úÖ |
| –£—Ä–æ–≤–Ω–∏ –ø–æ–∫—Ä—ã—Ç–∏—è | ‚ùå | ‚úÖ |
| –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ | ‚ùå | ‚úÖ |
| –ü—Ä–æ–º–æ-–∫–æ–¥—ã | ‚ùå | ‚úÖ |
| –°–∫–∏–¥–∫–∏ | ‚ùå | ‚úÖ |
| –ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å | ‚ùå | ‚úÖ |
| –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ | ‚ùå | ‚úÖ |
| –ü–æ—à–∞–≥–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç | ‚ùå | ‚úÖ |

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–±—É–¥—É—â–µ–µ)

–í –≤–µ—Ä—Å–∏–∏ 2.1 –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:

```http
POST /insurance/travel/v2/calculate HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## üìö SDK –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

### JavaScript/TypeScript
```bash
npm install @travel-insurance/api-client
```

```typescript
import { TravelInsuranceClient } from '@travel-insurance/api-client';

const client = new TravelInsuranceClient({
  apiKey: 'your-api-key',
  environment: 'production'
});

const premium = await client.calculatePremium({
  personFirstName: 'John',
  personLastName: 'Smith',
  // ...
});

console.log(`Premium: ${premium.agreementPrice} ${premium.currency}`);
```

### Python
```bash
pip install travel-insurance-sdk
```

```python
from travel_insurance import TravelInsuranceClient

client = TravelInsuranceClient(api_key='your-api-key')

premium = client.calculate_premium(
    person_first_name='John',
    person_last_name='Smith',
    # ...
)

print(f"Premium: {premium.agreement_price} {premium.currency}")
```

### Java
```xml
<dependency>
    <groupId>com.travel-insurance</groupId>
    <artifactId>api-client</artifactId>
    <version>2.0.0</version>
</dependency>
```

```java
TravelInsuranceClient client = new TravelInsuranceClient("your-api-key");

TravelCalculatePremiumRequestV2 request = TravelCalculatePremiumRequestV2.builder()
    .personFirstName("John")
    .personLastName("Smith")
    // ...
    .build();

TravelCalculatePremiumResponseV2 response = client.calculatePremium(request);
System.out.println("Premium: " + response.getAgreementPrice());
```

---

## üéì Best Practices

### 1. –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è
```json
{
  "personBirthDate": "1988-05-15"  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
}
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ISO –∫–æ–¥—ã —Å—Ç—Ä–∞–Ω
```json
{
  "countryIsoCode": "ES"  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
  // –Ω–µ "Spain" ‚ùå
}
```

### 3. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–æ–º–æ-–∫–æ–¥—ã –∑–∞—Ä–∞–Ω–µ–µ
```http
GET /insurance/travel/v2/promo-codes/SUMMER2025
```

### 4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```typescript
if (response.errors && response.errors.length > 0) {
  response.errors.forEach(error => {
    console.error(`${error.field}: ${error.message}`);
  });
}
```

### 5. –ö–µ—à–∏—Ä—É–π—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
```typescript
// –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –º–µ–Ω—è—é—Ç—Å—è —Ä–µ–¥–∫–æ, –º–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 1 –¥–µ–Ω—å
const countries = await client.getCountries();
localStorage.setItem('countries', JSON.stringify(countries));
```

---

**–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://docs.travel-insurance.com/api/v2  
**Swagger UI:** https://api.travel-insurance.com/swagger-ui/  
**Support:** support@travel-insurance.com